<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
        <!--
        Customize this policy to fit your own app's needs. For more guidance, see:
            https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
        Some notes:
            * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
            * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
            * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
                * Enable inline JS: add 'unsafe-inline' to default-src
        -->
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;"> -->
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="js/jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.css" />
        <script src="js/jquery-2.2.4.js"></script>
        <script src="js/jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script src="js/jquery.marquee.min.js" type="text/javascript"></script>
        <title>Mes radios</title>
    </head>
<body>

<div data-role="page" data-theme="b"> <!-- Début Page principale -->
  
    <div data-role="header" data-position="fixed"> <!-- Entête -->
		<div id="my_title" class='marquee' data-duration='15000' data-gap='0' data-duplicated='false'>Mes radios</div>
        <!-- <div class="marquee">jQuery marquee is the best <b>marquee</b> plugin in the world</div> -->
	</div>
	
	<div role="main" class="ui-content"> <!-- Corps principal -->

        <ul data-role="listview" data-inset="true" id="listviewRadios"> <!-- data-theme="b"  -->
        
            <li data-role="list-divider">Liste</li>

            <li><a href="#" data-val="controlaudio1" data-name="Génération Hit 80, des nouveautés et de tous les tubes pop rock dance des années 80's 90's 2000's Hits 2017" id="radio1">
                <img src="img/generationhit80.png"> <h2>Génération Hit 80</h2>
                <p><audio autoplay id="controlaudio1"><source src="https://listen.radioking.com/radio/17162/stream/49880" type="audio/mp3"></audio></p></a>
            </li>
                    
            <li><a href="#" data-val="controlaudio2" data-name="M Radio, numéro 1 sur la chanson française" id="radio2">
                <img src="img/mradio.png">  <h2>M Radio</h2>
                <p><audio id="controlaudio2"><source src="https://mfmwr-010.ice.infomaniak.ch/mfmwr-010.mp3" type="audio/mp3"></audio></p></a>
            </li>
            
            <li><a href="#" data-val="controlaudio3" data-name="Bide et Musique, la radio de l'improbable et de l'inouï." id="raio3">
                <img src="img/bideetmusique.png">   <h2>Bide et musique</h2>
                <p><audio id="controlaudio3"><source src="https://relay2.bide-et-musique.com:9300/bm.mp3" type="audio/mpeg"></audio></p></a>
            </li>

            <li><a href="#" data-val="controlaudio4" data-name="Radio Classique" id="radio4">
                <img src="img/radioclassique.png">  <h2>Radio classique</h2>
                <p><audio id="controlaudio4"><source src="https://radioclassique.ice.infomaniak.ch:80/radioclassique-high" type="audio/mp3"></audio></p></a>
            </li>
    		
            <li><a href="#" data-val="controlaudio5" data-name="France Info, actualités en temps réel et info en direct" id="radio5">
                <img src="img/franceinfo.png">  <h2>France Info</h2>
                <p><audio id="controlaudio5"><source src="https://direct.franceinfo.fr/live/franceinfo-hifi.aac" type="audio/mp3"></audio></p></a>
            </li>
            
            <li><a href="#" data-val="controlaudio6" data-name="Made in 80, la radio officielle des années 80" id="radio6">
                <img src="img/madein80.png">    <h2>Made in 80</h2>
                <p><audio id="controlaudio6"><source src="https://madein80.leswebradios.fr/stream#" type="audio/mpeg"></audio></p></a>
            </li>	

            <li><a href="#" data-val="controlaudio7" data-name="Une surprise" id="radio7">
                <img src="img/cadeau.png">  <h2>Surprise</h2>
                <p><audio id="controlaudio7"><source src="music/nggyu.mp3" type="audio/mpeg"></audio></p></a>
            </li>
            
        </ul>

    </div>
	
	<div data-role="footer" data-position="fixed"><!-- Pied de page -->
	
	         <div id="deviceready" class="blink">
                <p class="event listening">Connexion en cours</p>
                <p class="event received"><button name="buttonClick" onclick="exitFromApp();">Quitter</button></p>
            </div>
	</div>
	
<script type="text/javascript"> <!-- Quelques fonctions -->

    $(document).bind('pageinit', function() /* Lorsque la page est initialisée */
	{

        console.log("pageinit");

        var id;

        for(i=1; i<=7; i++)
        {
            currentid = 'controlaudio'+i;
            currentplayer = document.getElementById(currentid);
            console.log("On prépare le lecteur " + currentid);
            currentplayer.pause();
            currentplayer.currentTime = 0;
        }
        
        var isPlaying = function (service) {
            return service.currentAudio
                && service.currentAudio.currentTime > 0
                && !service.currentAudio.paused
                && !service.currentAudio.ended
                && service.currentAudio.readyState > 2;
        }
        
        function togglePause(myAudio) {
             if (myAudio.paused && myAudio.currentTime > 0 && !myAudio.ended) {
                 myAudio.play();
             } else {
                 myAudio.pause();
             }
        }

		function jouer(id,name)
		{
			console.log("jouer id="+id);
			
            for(i=1; i<=7; i++)
            {
                if( 'controlaudio'+i!=id)
                {
                    currentid = 'controlaudio'+i;
                    currentplayer = document.getElementById(currentid);
                    console.log("On arrête le lecteur " + currentid);
                    //currentplayer.pause();
                    //currentplayer.currentTime = 0;
                    //$(currentid).trigger("pause");
                    currentplayer.pause();
                }
            }
            
            $("#my_title").text('Vous écoutez ' + name); 
            $('#my_title').marquee();            
            lecteur = document.getElementById(id);
            lecteur.play();
            /*
            if( lecteur.paused || lecteur.currentTime == 0 )
            {
                console.log("Le id " + id + " n'est pas en lecture")

                lecteur.pause();
                lecteur.currentTime = 0;
                //lecteur.trigger("play");
                lecteur.play();
                // 

                //$(id).trigger("play");
          
				$("#my_title").text('Vous écoutez ' + name); 
				$('#my_title').marquee();
            }
            else
            {
                console.log("Le id " + id + " est en lecture")
				//document.getElementById(id).pause();
                //$(id).trigger("pause");
                lecteur.pause();
                //lecteur.trigger("pause");
                //lecteur.currentTime = 0;
            }
            */
            /*lecteur.play();
			*/
            /*            
            togglePause(lecteur)
            

			if ( lecteur.paused && lecteur.currentTime > 0 && !lecteur.ended )
			{
                console.log("Le id " + id + " n'est pas en lecture")
				document.getElementById(id).play();
				$("#my_title").text('Vous écoutez ' + name);
			}
            else
            {
                console.log("Le id " + id + " est en lecture")
				document.getElementById(id).pause();           
            }
            */
        }
	
        $('#listviewRadios a').click(function()
		{
			var id = $(this).data('val');
			var name = $(this).data('name');

            try
            {
                // $(this).attr("data-theme", "f").removeClass("ui-btn-up-b").addClass("ui-btn-up-f");
                $(this).attr("data-theme", "b").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");
            }
            catch(e)
            {
                console.log("Error trying addClass on #listviewRadios");
            }
                    
            console.log("Vous avez cliqué sur " + id + " de nom '" + name+"'");
			jouer(id, name);
        });
        
        $('#listviewRadios li' ).click(function()
        {
            console.log("#listviewRadios li' click event");
            // $(this).attr('data-theme','d');
            $(this).attr("data-theme", "b").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");
        });

    });
    
    
    $('#my_title').marquee({
        //duration in milliseconds of the marquee
        duration: 100,
        //gap in pixels between the tickers
        gap: 50,
        //time in milliseconds before the marquee will start animating
        delayBeforeStart: 0,
        //'left' or 'right'
        direction: 'left',
        //true or false - should the marquee be duplicated to show an effect of continues flow
        duplicated: true
    });
    
    function exitFromApp()
    {
        navigator.app.exitApp();
    }

</script>
	
</div> <!-- Fin Page principale -->

<script src="cordova.js"></script>
<script src="js/index.js"></script>

</body>
</html>
